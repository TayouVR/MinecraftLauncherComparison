---
import PlatformComponent from "./PlatformComponent.astro";
import ModloadersComponent from "./ModloadersComponent.astro";
import MinecraftResources from "./MinecraftResources.astro";
import JavaComponent from "./JavaComponent.astro";
import ModpacksComponent from "./ModpacksComponent.astro";


const { propertyName, launchers, propCategory } = Astro.props as { propertyName: string, launchers: LauncherDetails[], propCategory: "properties" | "features" };

function valueFromLauncher<TLauncher extends Record<"properties" | "features", Record<string, any>>>(launcher: LauncherDetails) {
    return (launcher as any as TLauncher)[propCategory][propertyName];
}

const values = launchers.map(launcher => {
    return {
        identifier: launcher.identifier,
        value: valueFromLauncher(launcher)
    }
});

---

{ (propertyName === "platforms") ? (
    <PlatformComponent launchers={launchers} values={values} />
) : (propertyName === "packages") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                <a href={`https://repology.org/project/${valueFromLauncher(launcher)}/versions`}>
                    <img src={`https://repology.org/badge/vertical-allrepos/${valueFromLauncher(launcher)}.svg`} alt="Packaging status">
                </a>
            </td>
        ))}
    </tr>
) : (propertyName === "technology") ? (
    <tr>
        <td>Languages</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {valueFromLauncher(launcher).languages.join(', ')}
            </td>
        ))}
    </tr>
    <tr>
        <td>Core Toolkits and Libraries</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {valueFromLauncher(launcher).frameworks.join(', ')}
            </td>
        ))}
    </tr>
) : (propertyName === "modpacks") ? (
    <ModpacksComponent launchers={launchers} values={values} />
) : (propertyName === "modloaders") ? (
    <ModloadersComponent launchers={launchers} values={values} />
) : (propertyName === "minecraftResources") ? (
    <MinecraftResources launchers={launchers} values={values} />
) : (propertyName === "java") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                <JavaComponent java={valueFromLauncher(launcher)} />
            </td>
        ))}
    </tr>
) : (propertyName === "sandboxing") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {valueFromLauncher(launcher).status}
            </td>
        ))}
    </tr>
) : (propertyName === "overlay") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {valueFromLauncher(launcher).status}
            </td>
        ))}
    </tr>
) : (propertyName === "advertisements") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {valueFromLauncher(launcher).status}
            </td>
        ))}
    </tr>
) : (propertyName === "import") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
                <td class={launcher.identifier}>
                    {valueFromLauncher(launcher).map((format: string) => (
                        <div class:list={["card", format.includes("ðŸš§") ? "wip" : ""]}><span>{format}</span></div>
                    ))}
                </td>
        ))}
    </tr>
) : (propertyName === "export") ? (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
                <td class={launcher.identifier}>
                    {valueFromLauncher(launcher).map((format: string) => (
                            <div class:list={["card", format.includes("ðŸš§") ? "wip" : ""]}><span>{format}</span></div>
                    ))}
                </td>
        ))}
    </tr>
) : (
    <tr>
        <td>{propertyName}</td>
        { launchers.map(launcher => (
            <td class={launcher.identifier}>
                {(typeof valueFromLauncher(launcher) === "string") ? (
                    valueFromLauncher(launcher).toUpperCase()
                ) : (typeof valueFromLauncher(launcher) === "number") ? (
                    valueFromLauncher(launcher).toFixed(2)
                ) : (Array.isArray(valueFromLauncher(launcher))) ? (
                    valueFromLauncher(launcher).join(', ')
                ) : (
                    "Unsupported Type"
                )}
            </td>
        ))}
    </tr>
)}